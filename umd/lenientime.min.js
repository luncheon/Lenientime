(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t():typeof define==="function"&&define.amd?define(t):e.lenientime=t()})(this,function(){"use strict";function e(e,t,n){e=String(e);if(!t||!isFinite(t)||e.length>=t){return e}return r(t-e.length,n)+e}function t(e,t,n){e=String(e);if(!t||!isFinite(t)||e.length>=t){return e}return e+r(t-e.length,n)}function r(e,t){t=t===undefined||t===null||t===""?" ":String(t);var r=t;while(r.length<e){r+=t}return r.substr(0,e)}function n(){for(var e=0,t=arguments.length;e<t;++e){var r=arguments[e];if(typeof r==="number"){return r}if(typeof r==="string"){var n=parseFloat(r);if(isFinite(n)){return n}}}return undefined}var i=1e3;var o=i*60;var u=o*60;var a=u*12;var l=u*24;function s(){return(Date.now()-(new Date).getTimezoneOffset()*o)%l}function f(e){var t=Math.floor(e)%l;return t>=0?t:t+l}function c(e){return e>=a?e-a:e}function p(e){return e<a?e+a:e}function h(e,t){e=f(e);switch(t&&String(t)[0].toLowerCase()){case"a":return c(e);case"p":return p(e);default:return e}}function d(e,t,r,n){if(n){++r;e=(e-t)%(r-t);return e<0?e+r:e+t}else{return e<t?t:e>r?r:e}}function m(e){switch(typeof e){case"number":return f(e);case"string":return y(e);case"object":if(e){return b(e instanceof Array?{h:e[0],m:e[1],s:e[2],S:e[3]}:e)}}return NaN}function b(e){if(e instanceof M){return e.totalMilliseconds}var t=n(e.h,e.hour,e.hours,0)*u+n(e.m,e.minute,e.minutes,0)*o+n(e.s,e.second,e.seconds,0)*i+n(e.S,e.millisecond,e.milliseconds,0);if(e.am===true||e.pm===false){return c(t)}if(e.pm===true||e.am===false){return p(t)}return h(t,e.a)}function y(e){e=e&&String(e).replace(/[\uff00-\uffef]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}).replace(/\s/g,"").replace(/(a|p)\.?m?\.?$/i,function(e,t){return t.toLowerCase()});if(!e){return 0}if(e.toLowerCase()==="now"){return s()}var t=e.match(/^([+-]?[0-9]{1,2})(?:([0-9]{2})(?:([0-9]{2})([0-9]*))?)?(a|p)?$/i)||e.match(/^([+-]?[0-9]*\.[0-9]*)()()()(a|p)?$/i)||e.match(/^([+-]?[0-9]*\.?[0-9]*):([+-]?[0-9]*\.?[0-9]*)(?::([+-]?[0-9]*\.?[0-9]*))?()(a|p)?$/i);return t?h((t[1]?parseFloat(t[1])*u:0)+(t[2]?parseFloat(t[2])*o:0)+(t[3]?parseFloat(t[3])*i:0)+(t[4]?parseFloat("0."+t[4])*1e3:0),t[5]):NaN}function g(){return/\\.|HH?|hh?|kk?|mm?|ss?|S{1,3}|AA?|aa?|_H|_h|_k|_m|_s/g}var v={H:O(0,23),HH:O(0,23,2,"0"),_H:O(0,23,2),h:O(1,12),hh:O(1,12,2,"0"),_h:O(1,12,2),k:O(0,11),kk:O(0,11,2,"0"),_k:O(0,23,2),m:O(0,59),mm:O(0,59,2,"0"),_m:O(0,59,2),s:O(0,59),ss:O(0,59,2,"0"),_s:O(0,59,2),S:O(0,9),SS:O(0,99,2,"0"),SSS:O(0,999,3,"0"),a:function(e){return function(t){return e==="pm"?"am":"pm"}},A:function(e){return function(t){return e==="PM"?"AM":"PM"}},aa:function(e){return function(t){return e==="p.m."?"a.m.":"p.m."}},AA:function(e){return function(t){return e==="P.M."?"A.M.":"P.M."}}};function O(t,r,n,i){if(n===void 0){n=1}return function(o){return function(u,a){var l=d(parseInt(o,10)+u,t,r,a);return isNaN(l)?undefined:e(l,n,i)}}}function j(e,t){return String(e).replace(g(),function(e){return e[0]==="\\"?e[1]:t[e]})}function P(e,t,r){var n=S(e);var i=0;var o=0;for(var u=0;u<n.length;++u){var a=n[u];if(a.literal){var l=t.indexOf(a.property,i);if(l===-1||l>=r){if(u===0){return}var s=t.slice(o,l);var f=n[u-1].property;return{property:f,index:o,value:s,adjust:v[f](s)}}else{o=i=l+a.property.length}}else if(a.property[0]==="_"&&t[i]===" "){++i}}var c=n[n.length-1];if(c&&!c.literal){var s=t.slice(i);var f=c.property;return{property:f,index:i,value:s,adjust:v[f](s)}}return}function S(e){var t=g();var r=[];var n=0;var i;while(i=t.exec(e)){var o=i.index;var u=t.lastIndex;if(n!==o){r.push({index:n,property:e.slice(n,o),literal:true})}if(i[0][0]==="\\"){r.push({index:o,property:i[0].slice(1),literal:true})}else{r.push({index:o,property:i[0],literal:false})}n=u}if(n<e.length){r.push({index:n,property:e.slice(n),literal:true})}return r}var M=function(){function r(e){this._totalMilliseconds=e}Object.defineProperty(r.prototype,"hour",{get:function(){return Math.floor(this._totalMilliseconds/u)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"hour12",{get:function(){return(this.hour+11)%12+1},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"minute",{get:function(){return Math.floor(this._totalMilliseconds%u/o)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"second",{get:function(){return Math.floor(this._totalMilliseconds%o/i)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"millisecond",{get:function(){return this._totalMilliseconds%i},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"am",{get:function(){return this.hour<12},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"pm",{get:function(){return this.hour>=12},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"hours",{get:function(){return this.hour},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"hours12",{get:function(){return this.hour12},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"minutes",{get:function(){return this.minute},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"seconds",{get:function(){return this.second},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"milliseconds",{get:function(){return this.millisecond},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"H",{get:function(){return this.invalid?"-":String(this.hour)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"h",{get:function(){return this.invalid?"-":String(this.hour12)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"k",{get:function(){return this.invalid?"-":String((this.hour+23)%24+1)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"m",{get:function(){return this.invalid?"-":String(this.minute)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"s",{get:function(){return this.invalid?"-":String(this.second)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"S",{get:function(){return this.invalid?"-":String(Math.floor(this.millisecond/100))},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"SS",{get:function(){return this.invalid?"--":t(Math.floor(this.millisecond/10),2,"0")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"SSS",{get:function(){return this.invalid?"---":t(this.millisecond,3,"0")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"a",{get:function(){return this.invalid?"--":this.am?"am":"pm"},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"A",{get:function(){return this.invalid?"--":this.am?"AM":"PM"},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"aa",{get:function(){return this.invalid?"----":this.am?"a.m.":"p.m."},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"AA",{get:function(){return this.invalid?"----":this.am?"A.M.":"P.M."},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"HH",{get:function(){return this.invalid?"--":e(this.H,2,"0")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"_H",{get:function(){return this.invalid?"--":e(this.H,2," ")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"hh",{get:function(){return this.invalid?"--":e(this.h,2,"0")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"_h",{get:function(){return this.invalid?"--":e(this.h,2," ")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"kk",{get:function(){return this.invalid?"--":e(this.k,2,"0")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"_k",{get:function(){return this.invalid?"--":e(this.k,2," ")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"mm",{get:function(){return this.invalid?"--":e(this.m,2,"0")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"_m",{get:function(){return this.invalid?"--":e(this.m,2," ")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"ss",{get:function(){return this.invalid?"--":e(this.s,2,"0")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"_s",{get:function(){return this.invalid?"--":e(this.s,2," ")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"HHmm",{get:function(){return this.HH+":"+this.mm},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"HHmmss",{get:function(){return this.HHmm+":"+this.ss},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"HHmmssSSS",{get:function(){return this.HHmmss+"."+this.SSS},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"totalMilliseconds",{get:function(){return this._totalMilliseconds},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"totalSeconds",{get:function(){return Math.floor(this._totalMilliseconds/i)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"totalMinutes",{get:function(){return Math.floor(this._totalMilliseconds/o)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"valid",{get:function(){return 0<=this._totalMilliseconds&&this._totalMilliseconds<l},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"invalid",{get:function(){return!this.valid},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"startOfHour",{get:function(){return new r(this._totalMilliseconds-this._totalMilliseconds%u)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"startOfMinute",{get:function(){return new r(this._totalMilliseconds-this._totalMilliseconds%o)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"startOfSecond",{get:function(){return new r(this._totalMilliseconds-this._totalMilliseconds%i)},enumerable:true,configurable:true});r.prototype.ifInvalid=function(e){return this.valid?this:new r(m(e))};r.prototype.startOf=function(e){switch(e){case"hour":return this.startOfHour;case"minute":return this.startOfMinute;case"second":return this.startOfSecond;default:return this}};r.prototype.toString=function(){return this.HHmmssSSS};r.prototype.format=function(e){return j(e,this)};r.prototype.with=function(e){return new r(m({h:n(e.h,e.hour,e.hours,this.hour),m:n(e.m,e.minute,e.minutes,this.minute),s:n(e.s,e.second,e.seconds,this.second),S:n(e.S,e.millisecond,e.milliseconds,this.millisecond),am:e.am===true||e.pm===false||(e.a==="am"?true:e.a==="pm"?false:undefined)}))};r.prototype.plus=function(e){var t=m(e);return t===0?this:new r(this._totalMilliseconds+t)};r.prototype.minus=function(e){var t=m(e);return t===0?this:new r(this._totalMilliseconds-t)};r.prototype.equals=function(e){return this.compareTo(e)===0};r.prototype.compareTo=function(e){return this._totalMilliseconds-m(e)};r.prototype.isBefore=function(e){return this.compareTo(e)<0};r.prototype.isBeforeOrEqual=function(e){return this.compareTo(e)<=0};r.prototype.isAfter=function(e){return this.compareTo(e)>0};r.prototype.isAfterOrEqual=function(e){return this.compareTo(e)>=0};r.prototype.isBetweenExclusive=function(e,t){return this.isAfter(e)&&this.isBefore(t)};r.prototype.isBetweenInclusive=function(e,t){return this.isAfterOrEqual(e)&&this.isBeforeOrEqual(t)};return r}();var _=new M(0);var w=new M(NaN);var H=function(e){if(e===undefined||e===null){return w}else if(e instanceof M){return e}else{var t=m(e);return t===0?_:isNaN(t)?w:new M(t)}};H.prototype=M.prototype;H.INVALID=w;H.ZERO=_;H.now=function(){return new M(s())};H.min=function(){return A(arguments,function(e,t){return e.invalid||t.isBefore(e)?t:e})};H.max=function(){return A(arguments,function(e,t){return e.invalid||t.isAfter(e)?t:e})};function A(e,t,r){if(r===void 0){r=w}var n=r;for(var i=0,o=e.length;i<o;++i){var u=H(e[i]);if(u.valid){n=t(n,u,i,e)}}return n}window.addEventListener("keydown",function(e){var t=e.which;if(t!==38&&t!==40||e.altKey||e.ctrlKey||e.metaKey){return}var r=e.target;var n=r.dataset;if(!("lenientimeAdjustOnArrowKeys"in n||"lenientime"in n)){return}e.preventDefault();var i=n.lenientimeFormat||n.lenientime||"HH:mm";var o=r.value;if(o){var u=r.selectionStart;var a=P(i,o,u);if(a){var l=(t===38?1:-1)*(parseFloat(n.lenientimeAdjustOnArrowKeys)||1);var s=a.adjust(l,true);if(s!==undefined){var f=a.index;r.value=o.slice(0,f)+s+o.slice(f+a.value.length);r.setSelectionRange(f,f+s.length)}}}else{r.value=H.ZERO.format(i);var a=P(i,r.value,0);if(a){r.setSelectionRange(a.index,a.index+a.value.length)}}},true);window.addEventListener("change",function(e){var t=e.target;var r=t.value;var n=t.dataset;if(r&&("lenientimeComplete"in n||"lenientime"in n)){var i=H(r);var o=i.valid?i.format(n.lenientimeFormat||n.lenientime||"HH:mm"):"";if(o!==r){t.value=o;var u=document.createEvent("CustomEvent");u.initCustomEvent("input",true,false,"complete");t.dispatchEvent(u)}}},true);return H});